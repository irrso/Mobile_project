# 🍴⭐ 전북대 음식 추천 앱 - 오늘 뭐 먹지

<div align="right">
  모바일프로그래밍
  🗓️ 2022.04.26 - 2022.06.20
</div>
<br>

<img src="https://github.com/irrso/mobile-programming-oneul-mwo-meokji/assets/105829324/f4a85689-9838-49ed-b82e-6cbb88db5cf7">
<br><br>

## 메인 아이디어
- 매번 어떤 음식을 먹을지 고르기 힘든데 누가 정해줄 수 없을까 ❓
- 비선호 음식, 카테고리를 기반으로 음식과 음식점을 동시에 추천해주자 💡
- 크롤링과 네이버 지도 API를 활용해 안드로이드 앱 제작 📲
<br>

## 사용자 인터페이스
<!--메인화면-->
<h3 align="center">
   앱 사용 중 움직여도 괜찮아요! 🔃
</h3>
<div align="center">

  **주소를 변경할 수 있어요 🤍** <br><br>
  <img src="https://github.com/irrso/mobile-programming-oneul-mwo-meokji/assets/105829324/95dee8d6-abba-4b2f-a019-ce49a5c2f0a3" width="30%" height="auto">
  <br><br>
  사용자의 위치가 변경되면 왼쪽 새로고침 버튼을 눌러주세요.
</div>
<hr>

<!--비선호음식-->
<h3 align="center">
   싫어하는 음식을 선택해 보세요! ☹️
</h3>
<div align="center">

  **37가지의 음식 중에 마음대로 골라보세요 🤍** <br><br>
  <img src="https://github.com/irrso/mobile-programming-oneul-mwo-meokji/assets/105829324/0bd9361a-0709-44e3-9fd8-df45ffdd7b58" width="28%" height="auto">
  <img src="https://github.com/irrso/mobile-programming-oneul-mwo-meokji/assets/105829324/614f3b43-0f67-454e-8f05-cfcb0a32cdda" width="28%" height="auto">
  <br><br>
  내린 엄지를 누르면 팝업창이 떠요.<br><br>
  선택한 음식은 추천 대상에서 제외돼요.<br><br>
  음식을 선택했다면 닫기 버튼을 눌러주세요.
</div>
<hr>

<!--카테고리-->
<h3 align="center">
   음식 카테고리를 선택해 보세요! ✔️
</h3>
<div align="center">

  **원하는 카테고리의 음식을 추천해 드려요 🤍** <br><br>
  <img src="https://github.com/irrso/mobile-programming-oneul-mwo-meokji/assets/105829324/56f9cb2c-1541-44b8-8555-71bdeabde3a3">
  <br><br>
  카테고리를 여러 개 선택할 수 있어요.<br><br>
  선택하지 않은 경우에는 모든 카테고리에서 추천해 드려요.
</div>
<hr>

<!--추천버튼-->
<h3 align="center">
   이제 손가락을 눌러 음식을 추천받아요! 👆🏻
</h3>
<div align="center">

  **랜덤하게 선택된 음식과 해당하는 음식점을 확인할 수 있어요 🤍** <br><br>
  <img src="https://github.com/irrso/mobile-programming-oneul-mwo-meokji/assets/105829324/b3bc6a23-af81-48bc-9943-1318ac5f7b45" width="30%" height="auto">
  <br><br>
  화면을 옆으로 넘기면 다른 음식점을 확인할 수 있어요.<br><br>
  다른 음식을 추천받고 싶다면 손가락을 다시 한번 눌러주세요.
</div>
<hr>

<!--거리,평점-->
<h3 align="center">
   음식점을 고르기 어렵다면 이 기능을 사용해 보세요! 🤔
</h3>
<div align="center">

  **거리순과 평점순으로 음식점들을 정렬할 수 있어요 🤍** <br><br>
  <img src="https://github.com/irrso/mobile-programming-oneul-mwo-meokji/assets/105829324/eb06abc6-7eac-4340-b75c-5125bc22573d" width="60%" height="auto"><br>
  <img src="https://github.com/irrso/mobile-programming-oneul-mwo-meokji/assets/105829324/95a3609b-b1ef-41c1-8f27-91b41f355b43" width="60%" height="auto">
  <br><br>
  거리순을 누르면 사용자와 거리가 가까운 순서대로 음식점을 확인할 수 있어요.<br><br>
  평점순을 누르면 평점이 높은 순서대로 음식점을 확인할 수 있어요.
</div>
<hr>

<!--음식점정보-->
<h3 align="center">
   음식점 화면을 눌러 정보를 확인해 보세요! 😋
</h3>
<div align="center">

  **팝업창에서 전화번호와 영업시간을 확인할 수 있어요 🤍** <br><br>
  <img src="https://github.com/irrso/mobile-programming-oneul-mwo-meokji/assets/105829324/4b280325-5acb-4412-919e-a00cf3b16afc" width="30%" height="auto">
  <br>
</div>
<hr>

<!--지도-->
<h3 align="center">
   하단의 지도 버튼을 눌러서 위치를 확인해봐요! 🗺️
</h3>
<div align="center">

  **네이버 지도에서 음식점의 위치를 확인할 수 있어요 🤍** <br><br>
  <img src="https://github.com/irrso/mobile-programming-oneul-mwo-meokji/assets/105829324/71f449a1-7770-4515-943f-657c0304c397" width="30%" height="auto">
  <br>
</div>
<br>

## 발표 영상
<a href="https://youtu.be/4uJ0ucmKLG8"><img src="https://img.shields.io/badge/Youtube-FF0000.svg?style=flat-square&logo=youtube&logoColor=white"/></a>
<br><br>

## 역할 분담
|팀원|팀원|
|:--:|:--:|
|[오소영](https://github.com/irrso)|[정성문](https://github.com/tjdans6342)|
|앱 디자인 설계<br>XML 레이아웃 구현<br>네이버 지도 API 연동<br>기능 로직 구현 보조<br>형상관리|음식점 정보 크롤링<br>기능 로직 구현<br>발표|
<br>

## 기술 스택
|분류|기술 스택|
|:--:|--|
|크롤링|<img src="https://img.shields.io/badge/Selenium-43B02A.svg?style=flat-square&logo=selenium&logoColor=white"/> <img src="https://img.shields.io/badge/Python-3776AB.svg?style=flat-square&logo=python&logoColor=white"/>|
|앱 제작|<img src="https://img.shields.io/badge/Android-34A853.svg?style=flat-square&logo=android&logoColor=white"/> <img src="https://img.shields.io/badge/Android Studio-3DDC84.svg?style=flat-square&logo=androidstudio&logoColor=white"/> <img src="https://img.shields.io/badge/Java-007396.svg?style=flat-square&logo=java&logoColor=white"/> <img src="https://img.shields.io/badge/Naver Cloud Platform-03C75A.svg?style=flat-square&logo=naver&logoColor=white"/>|
|협업|<img src="https://img.shields.io/badge/KakaoTalk-FFCD00.svg?style=flat-square&logo=kakaotalk&logoColor=black"/> <img src="https://img.shields.io/badge/GitHub-181717.svg?style=flat-square&logo=github&logoColor=white"/>|

### Selenium
- 음식점들의 이름, 카테고리, 전화번호, 영업시간 등을 수집하기 위해 사용
- `crawling.xls`로 데이터 저장

### Naver Cloud Platform
- `Reverse Geocoding API` 사용
- 좌표를 도로명 주소로 변환하여 현재 사용자의 주소를 나타냄
<br>

## 시스템 개요
<!--xml 레이아웃--> <!--MainActivity, CreateBasicInfo, DislikeFragment, GetFood, InfoFragment, ShopFragment 구조-->
### 클래스 다이어그램
<img src="https://github.com/irrso/mobile-programming-oneul-mwo-meokji/assets/105829324/96cc8cf7-1d36-4128-b8fa-a616c9b0d801">
<br><br>

## 시스템 기능
### 주소 가져오기
- `setLocation()` 함수를 호출하여 GPS로 현재 위도, 경도를 가져옴
- `getaddress()` 함수를 호출하여 `Reverse Geocoding API`를 사용 [^id1]
   [^id1]: 🚩 초기에는 `Geocoder` 클래스를 사용하였지만, 도로명 주소로 변환되지 않아 정확한 주소를 받아 올 수 없어 변경
- HTTP 요청을 보내고 응답을 받아 도로명 주소를 가져옴
- 도로명 주소 미발견 시 지번 주소를 가져옴
<img src="https://github.com/irrso/mobile-programming-oneul-mwo-meokji/assets/105829324/bb890c4a-16cc-42d1-83ea-a7f712d0e5a8">

<details>
    <summary> <img src="https://img.shields.io/badge/MainActivity.Java-007396.svg?style=flat-square"/> </summary>

  ```Java
   @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_main);

        /// 현재주소 업데이트
        ActivityCompat.requestPermissions(MainActivity.this, REQUIRED_PERMISSIONS, 100);
        location_t = findViewById(R.id.location_t);
        setLocation(); location_t.setText(getaddress());
        refreshBtn = findViewById(R.id.refresh);
        refreshBtn.setOnClickListener(new View.OnClickListener() {
            @Override
            public void onClick(View view) {
                setLocation();
                runOnUiThread(new Runnable() {
                    @Override
                    public void run() {
                        location_t.setText(getaddress());
                    }
                });
            }
        });

    // 경도,위도
    public void setLocation(){
        gpsTracker = new GpsTracker(MainActivity.this);
        latitude = gpsTracker.getLatitude();
        longitude = gpsTracker.getLongitude();
    }

    /// 주소 가져오기
    public String getaddress() {
        String finalAddress = "도로명주소 미발견";
        String finalAddress2 = "지번주소 미발견";
        try {
            BufferedReader bufferedReader = null;
            StringBuilder stringBuilder = new StringBuilder();
            String coord = longitude+","+latitude;
            Log.d("coord", coord);
            String query = "https://naveropenapi.apigw.ntruss.com/map-reversegeocode/v2/gc?request=coordsToaddr&coords="
                    + coord + "&sourcecrs=epsg:4326&output=json&orders=roadaddr&output=xml";
            URL url = null;
            HttpURLConnection conn = null;

            BufferedReader bufferedReader2 = null;
            StringBuilder stringBuilder2 = new StringBuilder();
            String query2 = "https://naveropenapi.apigw.ntruss.com/map-reversegeocode/v2/gc?request=coordsToaddr&coords="
                    + coord + "&sourcecrs=epsg:4326&output=json&orders=addr&output=xml";
            URL url2 = null;
            HttpURLConnection conn2 = null;

            try {
                url = new URL(query);
                url2 = new URL(query2);
                Log.d("request", "URL 됨");
            } catch (MalformedURLException e) {
                Log.d("request", "URL 안됨");
            }
            try {
                conn = (HttpURLConnection) url.openConnection();
                conn2 = (HttpURLConnection) url2.openConnection();
            } catch (IOException e) {
                Log.d("request", "http 안됨");
            }

            //도로명 주소
            if (conn != null) {
                conn.setConnectTimeout(5000);
                conn.setReadTimeout(5000);
                try {
                    conn.setRequestMethod("GET");
                    Log.d("request", "conn 됨");
                } catch (ProtocolException e) {
                    Log.d("request", "conn 안됨");
                }
                conn.setRequestProperty("X-NCP-APIGW-API-KEY-ID", "3hxuop6xkd");
                conn.setRequestProperty("X-NCP-APIGW-API-KEY", "illyoSwD97UiNVfZs4SI4eso09HNJ0CHjHAeRgh2");
                conn.setDoInput(true);

                int responseCode = 0;
                try {
                    responseCode = conn.getResponseCode();
                    Log.d("request", responseCode + "");
                } catch (IOException e) {
                    Log.d("request", "responseCode 안됨");
                }

                if (responseCode == 200) {
                    bufferedReader = new BufferedReader(new InputStreamReader(conn.getInputStream()));
                } else {
                    bufferedReader = new BufferedReader(new InputStreamReader(conn.getErrorStream()));
                    Log.d("request", "if responseCode 안됨");
                }

                String line = null;
                while ((line = bufferedReader.readLine()) != null) {
                    stringBuilder.append(line + "\n");
                }

                Gson gson = new Gson();
                Log.d("request", String.valueOf(stringBuilder));
                Addresses address = gson.fromJson(String.valueOf(stringBuilder), Addresses.class);
                if (address.results.length != 0) {
                    finalAddress = address.results[0].region.area2.name+" ";
                    finalAddress += address.results[0].region.area3.name+" ";
                    finalAddress += address.results[0].land.name+" ";
                    finalAddress += address.results[0].land.number1;
                }
                Log.d("request", finalAddress);
                bufferedReader.close();
                conn.disconnect();
            }

            //지번 주소
            if (conn2 != null) {
                conn2.setConnectTimeout(5000);
                conn2.setReadTimeout(5000);
                try {
                    conn2.setRequestMethod("GET");
                    Log.d("request2", "conn 됨");
                } catch (ProtocolException e) {
                    Log.d("request2", "conn 안됨");
                }
                conn2.setRequestProperty("X-NCP-APIGW-API-KEY-ID", "3hxuop6xkd");
                conn2.setRequestProperty("X-NCP-APIGW-API-KEY", "illyoSwD97UiNVfZs4SI4eso09HNJ0CHjHAeRgh2");
                conn2.setDoInput(true);

                int responseCode2 = 0;
                try {
                    responseCode2 = conn.getResponseCode();
                    Log.d("request2", responseCode2 + "");
                } catch (IOException e) {
                    Log.d("request2", "responseCode 안됨");
                }

                if (responseCode2 == 200) {
                    bufferedReader2 = new BufferedReader(new InputStreamReader(conn2.getInputStream()));
                } else {
                    bufferedReader2 = new BufferedReader(new InputStreamReader(conn2.getErrorStream()));
                    Log.d("request", "if responseCode 안됨");
                }

                String line2 = null;
                while ((line2 = bufferedReader2.readLine()) != null) {
                    stringBuilder2.append(line2 + "\n");
                }

                Gson gson2 = new Gson();
                Log.d("request2", String.valueOf(stringBuilder2));
                Addresses address2 = gson2.fromJson(String.valueOf(stringBuilder2), Addresses.class);
                finalAddress2 = address2.results[0].region.area2.name+" ";
                finalAddress2 += address2.results[0].region.area3.name+" ";
                finalAddress2 += address2.results[0].land.number1;
                if (address2.results[0].land.number2.length() != 0) finalAddress2 += "-" + address2.results[0].land.number2;
                Log.d("request2", finalAddress2);
                bufferedReader2.close();
                conn2.disconnect();
            }
        } catch (IOException e) {
            e.printStackTrace();
        }
        if(finalAddress != "도로명주소 미발견"){ return finalAddress; }
        else{ return finalAddress2; }
    }
  ```
</details>

### 팝업창 띄우기
- `DialogFragment`를 `custom_dialog`로 커스텀하여 팝업창 형식으로 구현 [^id2]
  [^id2]: 🚩 초기에는 `ExpendableListView`로 구현하였으나 사용 편의성을 위해 팝업 형식으로 구현
<img src="https://github.com/irrso/mobile-programming-oneul-mwo-meokji/assets/105829324/0b710bcc-a031-4569-b340-5375e02e50d1" width="20%" height="auto">
<img src="https://github.com/irrso/mobile-programming-oneul-mwo-meokji/assets/105829324/8e090c4e-374d-4a83-b008-e76b4fd794ab" width="20%" height="auto">

<details>
    <summary> <img src="https://img.shields.io/badge/DislikeFragment.Java-007396.svg?style=flat-square"/> </summary>

  ```Java
   public class DislikeFragment extends DialogFragment {

    Button closeBtn;
    Button[] disBtn = new Button[37];
    int[] dId = {
            R.id.bibimbap, R.id.calgooksu, R.id.gooksu, R.id.gookbap, R.id.haejanggook, R.id.gopchang, R.id.ssapbap, R.id.budaezzigae, R.id.zzimdark, R.id.soondae,
            R.id.naengmyen, R.id.gogi, R.id.zockbal, R.id.dosirock, R.id.pasta, R.id.dongas, R.id.steak, R.id.pizza, R.id.pilaf, R.id.hamburger,
            R.id.sandwitch, R.id.toast, R.id.kebap, R.id.soba, R.id.ramen, R.id.chobap, R.id.hoe, R.id.yeoneh, R.id.oodong, R.id.kare,
            R.id.zzazangmyen, R.id.zzamppong, R.id.maratang, R.id.tangsuyook, R.id.tteokboki, R.id.kimbap, R.id.chicken
    };

    @Override
    public void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setStyle(STYLE_NO_TITLE, R.style.custom_dialog);
    }

    @Override
    public View onCreateView(LayoutInflater inflater, ViewGroup container,
                             Bundle savedInstanceState) {
        View view = inflater.inflate(R.layout.fragment_dislike, container, false);

        closeBtn = view.findViewById(R.id.closeBtn);
        closeBtn.setOnClickListener(new View.OnClickListener() {
            @Override
            public void onClick(View view) {
                dismiss();
            }
        });

        // 비선호 버튼 클릭
        for(int i = 0; i < 37; i++){
            disBtn[i] = view.findViewById(dId[i]);
            int index = i;
            disBtn[i].setOnClickListener(new View.OnClickListener() {
                @Override
                public void onClick(View view) {
                    setClicked(index);
                }
            });
            // 길게 누르면 선호 쌉가능
            disBtn[i].setOnLongClickListener(new View.OnLongClickListener() {
                @Override
                public boolean onLongClick(View view) {
                    setLongClicked(index);
                    return true;
                }
            });
        }

        //값 복원
        for (int i = 0; i < 37; i++) {
            if(((MainActivity)MainActivity.context).dislike[i] == true){
                disBtn[i].setBackgroundResource(R.drawable.button_round_clicked); disBtn[i].setTextColor(Color.WHITE);}
        }

        return view;
    }

    public void setClicked(int i){
        if(((MainActivity)MainActivity.context).dislike[i] == false){ disBtn[i].setBackgroundResource(R.drawable.button_round_clicked); disBtn[i].setTextColor(Color.WHITE); ((MainActivity)MainActivity.context).dislike[i] = true;}
        else{ disBtn[i].setBackgroundResource(R.drawable.button_round); disBtn[i].setTextColor(Color.parseColor("#919191")); ((MainActivity)MainActivity.context).dislike[i] = false; }
    }

    public void setLongClicked(int idx) {
        for (int i=0; i<37; i++) {
            disBtn[i].setBackgroundResource(R.drawable.button_round_clicked);
            disBtn[i].setTextColor(Color.WHITE);
            ((MainActivity)MainActivity.context).dislike[i] = true;
        }
        setClicked(idx);
    }
}
  ```
</details>

<details>
    <summary> <img src="https://img.shields.io/badge/InfoFragment.Java-007396.svg?style=flat-square"/> </summary>

  ```Java
   public class InfoFragment extends DialogFragment {

    Button closeBtn2, phoneImg, timeImg;
    TextView name, classification, phoneNum, phoneNum_t, worktime, worktime_t;

    @Override
    public void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setStyle(STYLE_NO_TITLE, R.style.custom_dialog);
    }

    @Override
    public View onCreateView(LayoutInflater inflater, ViewGroup container,
                             Bundle savedInstanceState) {
        View view =  inflater.inflate(R.layout.fragment_info, container, false);

        name = view.findViewById(R.id.name);
        classification = view.findViewById(R.id.classification);
        phoneNum = view.findViewById(R.id.phoneNum);
        worktime = view.findViewById(R.id.worktime);
        phoneNum_t = view.findViewById(R.id.phoneNum_t);
        worktime_t = view.findViewById(R.id.worktime_t);
        phoneImg = view.findViewById(R.id.phoneImg);
        timeImg = view.findViewById(R.id.timeImg);

        transContext();

        closeBtn2 = view.findViewById(R.id.closeBtn2);
        closeBtn2.setOnClickListener(new View.OnClickListener() {
            @Override
            public void onClick(View view) {
                dismiss();
            }
        });
        return view;
    }

    public void transContext(){
        for (int i = 0; i < ((MainActivity)MainActivity.context).num_page; i++){
            if(((MainActivity)MainActivity.context).pager.getCurrentItem() == i){
                name.setText(((MainActivity)MainActivity.context).name[i]);
                classification.setText(((MainActivity)MainActivity.context).classfication[i]);
                if (((MainActivity)MainActivity.context).phoneNum[i].charAt(0) != '0') phoneNum.setText("전화번호 정보 없음");
                else phoneNum.setText(((MainActivity)MainActivity.context).phoneNum[i]);
                worktime.setText(((MainActivity)MainActivity.context).worktime[i]);
                if(((MainActivity)MainActivity.context).name[i] != null){
                    phoneNum_t.setText("전화번호"); phoneImg.setVisibility(View.VISIBLE);
                    worktime_t.setText("영업시간"); timeImg.setVisibility(View.VISIBLE);
                }
            }
        }
    }
}
  ```
</details>

<details>
    <summary> <img src="https://img.shields.io/badge/themes.xml-007396.svg?style=flat-square"/> </summary>

  ```Java
   <style name="custom_dialog" parent="Theme.AppCompat.Dialog">
        <item name="android:windowIsFloating">false</item>
        <item name="android:windowFullscreen">false</item>
        <item name="android:windowBackground">@android:color/transparent</item>
        <item name="android:textViewStyle">@style/custom_textFont</item>
        <item name="android:buttonStyle">@style/custom_btnFont</item>
        <item name="android:backgroundDimEnabled">true</item>
        <item name="android:backgroundDimAmount">0.8</item>
    </style>
  ```
</details>

### 추천 기능
- `CreateGetGood()` 함수를 호출하여 `GetFood` 객체 `GF` 생성
- `SetSortedPage()` 함수를 호출하여 `setShop()`, `setPager()` 함수 호출
- `CreateBasicInfo` 객체 `CBI` 생성하여 `get_path()` 함수를 호출하여 `crawling.xls`에서 음식점 데이터 가져옴

<details>
    <summary> <img src="https://img.shields.io/badge/MainActivity.Java-007396.svg?style=flat-square"/> </summary>

  ```Java
        /// selectBtn 클릭
        selectBtn = findViewById(R.id.selectBtn);
        selectBtn.setOnClickListener(new View.OnClickListener() {
            @Override
            public void onClick(View view) {
                CreateGetFood(); // GetFood() 객체 생성
                setSortedPage(); // 옵션에 맞게 가게 띄우기
            }
        });

        context = this; //MainActivity 변수 사용

        CreateBasicInfo CBI =  new CreateBasicInfo();
        basicInfo = CBI.basicInfo;
        nameToIdx = CBI.nameToIdx;


    /// 엑셀 불러오기
    public InputStream get_path() {
        try {
            InputStream temp_is = getBaseContext().getResources().getAssets().open("crawling.xls");
            return temp_is;
        } catch (Exception e){
            e.printStackTrace();
            Log.d("crawling", "안됨");
            return null;
        }
    }


    // GetFood() 객체 생성
    public void CreateGetFood() {
        // 카테고리 업데이트
        for (int i=0; i<37; i++) categoryFoods[i] = false;
        for (int i=0; i<6; i++) {
            if (category[i]) {
                for (Integer j : categoryList.get(i)) categoryFoods[j] = true;
            }
        }
        // GetFood 객체 생성
        GF = new GetFood(context);
    }


    // 정렬 옵션에 맞게 띄우기
    public void setSortedPage() {
        num_page = GF.SIZE; // 페이지 개수 지정
        setShop();
        setPager();
        mapBtn.setVisibility(View.VISIBLE); infoBtn.setVisibility(View.VISIBLE);
        leftBtn.setVisibility(View.VISIBLE); rightBtn.setVisibility(View.VISIBLE);
        food_t = findViewById(R.id.food_t); food_t.setText(GF.food);
        Log.d("dist", latitude+","+longitude);
    }
  ```
</details>

<details>
    <summary> <img src="https://img.shields.io/badge/GetFood.Java-007396.svg?style=flat-square"/> </summary>

  ```Java
   public GetFood(Context context) { // 입력(double latitude, double longitude) => distanceInfo
        // 랜덤하게 음식 하나 뽑기
        int foodIdx;
        {
            // 카테고리 음식 & 비선호 음식 처리
            boolean isNotSelected = true;
            for (int i = 0; i < 6; i++) {
                if (category[i]) isNotSelected = false;
            }
            if (isNotSelected) {
                for (int i = 0; i < 37; i++) categoryFoods[i] = true;
            }

            // 예외인 경우 처리 (뽑힐 후보가 없는 경우)
            boolean flag = false;
            for (int i = 0; i < 37; i++) {
                if (!dislike[i] && categoryFoods[i]) flag = true;
            }
            if (!flag) { // 예외 처리 (비선호가 37개인 경우)
                Toast.makeText(context, "카테고리와 비선호 음식을 확인해주세요.", Toast.LENGTH_SHORT).show();
                for (int i = 0; i < 37; i++) dislike[i] = false;
            }

            // 후보 중에서 랜덤하게 선택
            while (true) {
                foodIdx = random.nextInt(37);
                if (!dislike[foodIdx] && categoryFoods[foodIdx]) break;
            }
        }
        food = idxToName[foodIdx];
        SIZE = basicInfo.get(foodIdx).size();
        Log.d("getFood", food + " / " + foodIdx + " / " + SIZE); //


        // 거리 계산해서 basicInfo 의 distance 에 넣기
        {
            double cur_lat = ((MainActivity)MainActivity.context).longitude;
            double cur_lon = ((MainActivity)MainActivity.context).latitude;
            for (int i=0; i<SIZE; i++) {
                double shop_lat = Double.parseDouble(basicInfo.get(foodIdx).get(i).latitude);
                double shop_lon = Double.parseDouble(basicInfo.get(foodIdx).get(i).longitude);
                double dist = calculateDistance(cur_lat, cur_lon, shop_lat, shop_lon);
                dist = Math.round(dist*1000);
                basicInfo.get(foodIdx).get(i).distance = dist;
            }
        }


        // 랜덤 배열 만들기
        int[] randomIdx = new int[SIZE]; {
            Integer[] array = new Integer[SIZE];
            for (int i = 0; i < SIZE; i++) array[i] = i;
            List<Integer> list = Arrays.asList(array);

            Collections.shuffle(list);
            list.toArray(array);
            for (int i=0; i<SIZE; i++) randomIdx[i] = array[i];
        }
        for (int i=0; i<SIZE; i++) randomInfo.add(basicInfo.get(foodIdx).get(randomIdx[i]));


        // 평점 배열 만들기
        int[] rankIdx = new int[SIZE]; {
            double[][] array = new double[SIZE][2];
            for (int i=0; i<SIZE; i++) {
                double rank;
                {
                    String rankStr = basicInfo.get(foodIdx).get(i).rank;
                    try {
                        rank = Double.parseDouble(rankStr);
                    } catch (Exception e) {
                        rank = 0.0;
                    }
                }

                int idx = i;

                array[i][0] = rank;
                array[i][1] = idx;
            }
            Arrays.sort(array, Comparator.comparingDouble(o1 -> o1[0]));

            double[][] array2 = new double[SIZE][2];
            for (int i=0; i<SIZE; i++) {
                array2[i][0] = array[SIZE-i-1][0];
                array2[i][1] = array[SIZE-i-1][1];
            }

            for (int i=0; i<SIZE; i++) rankIdx[i] = (int) array2[i][1];
        }
        for (int i=0; i<SIZE; i++) rankInfo.add(basicInfo.get(foodIdx).get(rankIdx[i]));
  ```
</details>

<details>
    <summary> <img src="https://img.shields.io/badge/CreateBasicInfo.Java-007396.svg?style=flat-square"/> </summary>

  ```Java
   public class CreateBasicInfo {
    Vector<Vector<BasicInfo>> basicInfo = new Vector<Vector<BasicInfo>>(37);
    HashMap<String, Integer> nameToIdx = new HashMap<String, Integer>();


    public CreateBasicInfo() {
        for(int i=0; i<37; i++) basicInfo.add(new Vector<BasicInfo>());

        String[] foods = ((MainActivity)MainActivity.context).idxToName;

        // 엑셀에서 데이터 받아오기
        try {
            InputStream is = ((MainActivity)MainActivity.context).get_path();
            POIFSFileSystem fs = new POIFSFileSystem(is);
            HSSFWorkbook wb = new HSSFWorkbook(fs);

            for (int foodIdx=0; foodIdx<foods.length; foodIdx++) {
                // name -> idx 매핑
                nameToIdx.put(foods[foodIdx], foodIdx);

//                Log.d("crawling", "food idx is : " + foodIdx + " " + foods[foodIdx]); //
                Log.d("crawling", "food idx is : " + nameToIdx.get(foods[foodIdx]) + " " + foods[foodIdx]); //
                Sheet sheet = wb.getSheet(foods[foodIdx]);

                for (int i = 0; i < sheet.getPhysicalNumberOfRows(); i++) {
                    if (i == 0) continue;
                    Row row = sheet.getRow(i);
                    String[] s = new String[9];

                    if (row != null) {
                        for (int j = 0; j <= row.getPhysicalNumberOfCells(); j++) { // 블록 단위 처리
                            Cell cell = row.getCell(j);

                            if (cell == null) continue;
                            else {
                                switch(cell.getCellType()){
                                    case FORMULA:
                                        s[j] = cell.getCellFormula();
                                        break;
                                    case NUMERIC:
                                        s[j] = cell.getNumericCellValue()+"";
                                        break;
                                    case STRING:
                                        s[j] = cell.getStringCellValue()+"";
                                        break;
                                    case BLANK:
                                        s[j] = cell.getBooleanCellValue()+"";
                                        break;
                                    case ERROR:
                                        s[j] = cell.getErrorCellValue()+"";
                                        break;
                                }
                            }
                        }
                    }
                    BasicInfo temp = new BasicInfo(s);
                    basicInfo.get(foodIdx).add(temp);
                }
                Log.d("crawling", "v.get(foodIdx).size() is : " + basicInfo.get(nameToIdx.get(foods[foodIdx])).size()); //
                Log.d("crawling", "됨");

            }
        }
        catch (Exception e){
            e.printStackTrace();
            Log.d("crawling", "안됨");
        }
//        Log.d("crawling", v.get(2).get(1).phoneNum);
    }


}
  ```
</details>


### 음식점 화면 구성
- `ViewPager2`를 사용하여 음식점 화면을 옆으로 넘길 수 있게 구현
- `CircleIndicator3`를 사용하여 현재 페이지의 인덱스를 표현
<img src="https://github.com/irrso/mobile-programming-oneul-mwo-meokji/assets/105829324/eb06abc6-7eac-4340-b75c-5125bc22573d" width="50%" height="auto">

<details>
    <summary> <img src="https://img.shields.io/badge/MainActivity.Java-007396.svg?style=flat-square"/> </summary>

  ```Java
   // ViewPager, Indicator 설정
    public void setPager(){
        //ViewPager2
        pager = findViewById(R.id.viewPager);
        PagerAdapter adapter = new PagerAdapter(this);
        pager.setAdapter(adapter);

        //pager 설정
        pager.registerOnPageChangeCallback(new ViewPager2.OnPageChangeCallback() {
            @Override
            public void onPageSelected(int position) {
                super.onPageSelected(position);
                indicator.animatePageSelected(position);
                POSITION = position;
            }
        });

        //Indicator
        indicator = findViewById(R.id.indicator);
        indicator.setViewPager(pager);
        indicator.createIndicators(num_page, 0);
    }
  ```
</details>

<details>
    <summary> <img src="https://img.shields.io/badge/activity_main.xml.Java-007396.svg?style=flat-square"/> </summary>

  ```Java
   <FrameLayout
        android:layout_width="match_parent"
        android:layout_height="320dp">

        <androidx.viewpager2.widget.ViewPager2
            android:id="@+id/viewPager"
            android:layout_width="match_parent"
            android:layout_height="match_parent" />

        <me.relex.circleindicator.CircleIndicator3
            android:id="@+id/indicator"
            android:layout_width="match_parent"
            android:layout_height="wrap_content"
            android:layout_gravity="bottom"
            android:layout_marginBottom="10dp"
            app:ci_drawable="@drawable/indicator_selected"
            app:ci_drawable_unselected="@drawable/indicator_unselected"
            app:ci_height="7dp"
            app:ci_margin="4dp"
            app:ci_width="7dp" />
    </FrameLayout>
  ```
</details>

### 토스트 메시지
- 비선호 음식 선택과 카테고리 기능을 통해 추천할 수 있는 음식이 존재하지 않는 경우 알림
- 정상 작동을 위해 비선호 음식 선택을 배제하여 카테고리 만으로 음식을 추천
<img src="https://github.com/irrso/mobile-programming-oneul-mwo-meokji/assets/105829324/a21b9657-d76c-42f4-8fd4-e9f53f25db35">

<details>
    <summary> <img src="https://img.shields.io/badge/GetFood.Java-007396.svg?style=flat-square"/> </summary>

  ```Java
            // 예외인 경우 처리 (뽑힐 후보가 없는 경우)
            boolean flag = false;
            for (int i = 0; i < 37; i++) {
                if (!dislike[i] && categoryFoods[i]) flag = true;
            }
            if (!flag) { // 예외 처리 (비선호가 37개인 경우)
                Toast.makeText(context, "카테고리와 비선호 음식을 확인해주세요.", Toast.LENGTH_SHORT).show();
                for (int i = 0; i < 37; i++) dislike[i] = false;
            }

            // 후보 중에서 랜덤하게 선택
            while (true) {
                foodIdx = random.nextInt(37);
                if (!dislike[foodIdx] && categoryFoods[foodIdx]) break;
            }
  ```
</details>
